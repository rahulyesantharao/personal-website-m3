<!doctypehtml><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta charset=UTF-8><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=ngkk92kKld"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=ngkk92kKld"><link rel=icon type=image/png sizes=194x194 href="/favicon-194x194.png?v=ngkk92kKld"><link rel=icon type=image/png sizes=192x192 href="/android-chrome-192x192.png?v=ngkk92kKld"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=ngkk92kKld"><link rel=manifest href="/manifest.json?v=ngkk92kKld"><link rel=mask-icon href="/safari-pinned-tab.svg?v=ngkk92kKld"color=#2b669b><link rel="shortcut icon"href="/favicon.ico?v=ngkk92kKld"><meta name=msapplication-TileColor content=#2b669b><meta name=msapplication-TileImage content="/mstile-144x144.png?v=ngkk92kKld"><meta name=theme-color content=#2b669b><meta property=og:url content=https://rahulyesantharao.com/blog/posts/dual-booting-windows-10-and-arch-linux><meta property=og:type content=article><meta property=og:title content="Dual Booting Windows 10 and Arch Linux"><meta property=og:description content="How to dual boot Arch Linux onto a Razer Blade 14"><meta property=og:image content=https://rahulyesantharao.com/images/ry.7af6e3a8550f5db9ffe794a2bed497c3.png><meta property=og:image:secure_url content=https://rahulyesantharao.com/images/ry.7af6e3a8550f5db9ffe794a2bed497c3.png><meta property=og:image:type content=image/png><meta property=og:image:width content=805><meta property=og:image:height content=805><meta property=twitter:card content=summary><meta property=twitter:site content=@rahulvgy><meta property=twitter:creator content=@rahulvgy><meta property=twitter:title content="Dual Booting Windows 10 and Arch Linux"><meta property=twitter:description content="How to dual boot Arch Linux onto a Razer Blade 14"><meta property=twitter:image content=https://rahulyesantharao.com/images/ry.7af6e3a8550f5db9ffe794a2bed497c3.png><meta property=twitter:image:alt content="How to dual boot Arch Linux onto a Razer Blade 14"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css><link rel=stylesheet href=../../../css/main.507e1f48b2db4f8c79ea01aa9caf8aa0.css><title>Dual Booting Windows 10 and Arch Linux | Blog | Rahul Yesantharao</title><header><nav class=navbar><div class=navbar-menu-drawer id=navbar-menu-drawer><div class=navbar-item><a target=_self href=/about/ >ABOUT</a></div><div class=navbar-item><a target=_self href=/courses/ >COURSES</a></div><div class=navbar-item><a target=_self href=/blog/ class=active>BLOG</a></div></div><div class=navbar-left><div class="navbar-item is-hidden-desktop"><div class=navbar-burger id=navbar-burger onclick=toggleMenu()><span></span> <span></span> <span></span></div></div><div class=navbar-item id=logo><a target=_self href=/ ><span>Rahul Y</span></a></div></div><div class=navbar-menu-desktop><div class=navbar-item><a target=_self href=/about/ >ABOUT</a></div><div class=navbar-item><a target=_self href=/courses/ >COURSES</a></div><div class=navbar-item><a target=_self href=/blog/ class=active>BLOG</a></div></div></nav></header><section class="container-fluid page-title"id=blogHeader><div class=container><div class="columns is-centered"><div class="column is-12-mobile is-8-desktop is-8-tablet"><h1><span>/usr/etc/rahul/*</span></h1></div></div></div></section><section class="container top-pad"><div class="columns is-centered"><div class="column is-12-mobile is-8-desktop is-8-tablet"><h2 style=margin-top:.6rem;font-size:4rem><span>Dual Booting Windows 10 and Arch Linux</span></h2><h3 style=font-size:1rem;color:#2b669b>July 17, 2018 | Updated: November 12, 2018</h3><div class="text blog-post"><p>Recently, I dual-booted my computer (Razer Blade 14" 2017, Intel 7700HQ - GTX1060) with Arch Linux, and I wanted to document the process here to make it easier for any others who are planning on a similar process. Note that this is for a UEFI machine that already runs Windows 10 (although the instructions may easily translate to some other setups).<h2>Reading</h2><p>Before beginning the dual boot process, I decided to first read about the boot process and Linux in general; although not strictly necessary, this reading was interesting and helped me understand all the steps involved in the dual boot process. I have listed some basic links I would recommend reading before, in order to get a clear understanding the boot process and related technologies.<ul><li><span><a href=https://en.wikipedia.org/wiki/Booting target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/Booting</a></span><li><span><a href=https://en.wikipedia.org/wiki/Firmware target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/Firmware</a></span><li><span><a href=https://en.wikipedia.org/wiki/Disk_partitioning target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/Disk_partitioning</a></span><li><span><a href=https://en.wikipedia.org/wiki/BIOS target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/BIOS</a></span><li><span><a href=https://en.wikipedia.org/wiki/Master_boot_record target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/Master_boot_record</a></span><li><span><a href=https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface</a></span><li><span><a href=https://en.wikipedia.org/wiki/GUID_Partition_Table target=_blank rel="noopener noreferrer external">https://en.wikipedia.org/wiki/GUID_Partition_Table</a></span><li><span><a href=https://www.cs.tau.ac.il/telux/lin-club_files/linux-boot/slide0000.htm target=_blank rel="noopener noreferrer external">https://www.cs.tau.ac.il/telux/lin-club_files/linux-boot/slide0000.htm</a></span></ul><h2>Windows Preparation</h2><p>First, just to be safe, it is important to completely back up any important files you have saved on your computer.<p>Then, open up <em>Disk Management</em> (open Command Prompt as Administrator and type in <code>diskmgmt.msc</code>) (see the figure below) and create space for the Linux installation. There should be at least 3 basic partitions: EFI System Partition, OEM, and Windows (the main partition that takes most of the space). In addition, there may be an extra recovery partition - beyond the first 3, you can choose whether or not to delete the extra partitions (consider the warranty and other aspects specific to your computer, I chose to leave my recovery partition). Choose the large Windows partition, right click it, and choose shrink - the amount by which you shrink is the amount of space you will have for your Linux installation. This new space will show up as unpartitioned space - this is what we want.<p><img alt="Disk Management"src=https://rahulyesantharao.com/resources/img/diskmgmt.min.png title="Disk Management Setup"><p>Now, we will prepare for the actual Linux boot process. First, <a href=https://www.tenforums.com/tutorials/4189-turn-off-fast-startup-windows-10-a.html target=_blank rel="noopener noreferrer external"><strong>turn off Windows Fast Startup</strong></a>. Then, hold down shift and press the restart button to open the troubleshooting menu. Choose Troubleshoot > Advanced Options > UEFI Firmware Settings. Then, on restart, the UEFI options will open. Disable Intel Fast Boot and Secure Boot (details <a href=https://wiki.archlinux.org/index.php/Dual_boot_with_Windows#UEFI_Secure_Boot target=_blank rel="noopener noreferrer external">here</a>).<h2>Installation Media</h2><p>Download an Arch Linux ISO from the <a href=https://www.archlinux.org/download/ target=_blank rel="noopener noreferrer external">Downloads Page</a> (verify the checksums, noting the <a href=https://www.archlinux.org/master-keys/ target=_blank rel="noopener noreferrer external">Master Signing Keys</a>). Then, download <a href=https://rufus.akeo.ie/ target=_blank rel="noopener noreferrer external">Rufus</a>, a USB drive formatting utility (alternatively, you can use <code>dd</code> if you have a machine running Linux or MacOS). Get a USB drive that doesn't have any data you need (it will be wiped by the boot drive formatting process), and plug it in. Start up Rufus; it should automatically recognize the USB drive. After ascertaining that it has the correct drive, choose the Arch Linux ISO and start the format process (I also chose FAT32, the UEFI/GPT partition scheme, check device for bad blocks with 1 pass and unchecked quick format). Make sure to choose <em>DD Image</em> mode after choosing Start (see more <a href=https://wiki.archlinux.org/index.php/USB_flash_installation_media#Using_Rufus target=_blank rel="noopener noreferrer external">here</a>).<h2>Booting Into Linux</h2><p>Plug in the USB (the computer will not recognize it because of the DD formatting). Restart Windows, and press the correct key to go into the Boot Menu (on the Razer Blade, smash F12). In the Boot Menu, choose your USB (will show up as something relating to EFI USB). In the Arch Linux boot screen that shows up next, choose the first default option, "Arch Linux archiso x86_64 UEFI USB". Now, we are entered into an Arch Linux shell running off the USB - it will recognize the laptop's internal hard drive as an attached device.<h2>Setting up for Install</h2><h3>Connect to WiFi</h3><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ iw dev <span class=c1># Get WiFi interface name</span>
$ wifi-menu <span class=c1># Open graphical interface to select WiFi network</span>
$ ping google.com <span class=c1># Check connection, might take a few seconds</span>
</code></pre></div></table><h3>Create Partitions</h3><p>Use <code>lsblk -f</code> or <code>fdisk -l</code> to identify the <a href=https://unix.stackexchange.com/a/259200 target=_blank rel="noopener noreferrer external">block devices</a>. You should see at least two devices (the USB and the internal hard drive) - identify the name (e.g. <code>/dev/sda</code> or <code>/dev/nvme0n1</code>) of your internal hard drive. This is the device file where the hard drive is mounted.<p>We need to create 3 partitions for the Linux installation - the main filesystem, the boot partition, and the swap partition. We will now use <code>gdisk</code> to create the partitions:<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ gdisk /dev/nvme0n1 <span class=c1># Open gdisk partitioning utility</span>
$ n <span class=c1># Create new partition (for boot)</span>
$ <enter> <span class=c1># Use default partition number</span>
$ <enter> <span class=c1># Automatically starts at beginning of unallocated space</span>
$ +200MB <span class=c1># Set space for the boot partition</span>
$ <span class=m>8300</span> <span class=c1># Hex code for Linux filesystem</span>
$ n <span class=c1># Create new partition (for swap partition)</span>
$ <enter> <span class=c1># Use default partition number</span>
$ <enter> <span class=c1># Automatically starts at beginning of unallocated space</span>
$ +8GB <span class=c1># Size of the swap partition (can also use 16 GB)</span>
$ <span class=m>8200</span> <span class=c1># Hex code for Linux swap partition</span>
$ n <span class=c1># Create new partition (for filesystem)</span>
$ <enter> <span class=c1># Use default partition number</span>
$ <enter> <span class=c1># Automatically starts at beginning of unallocated space</span>
$ <enter> <span class=c1># Use the rest of the space</span>
$ <span class=m>8300</span> <span class=c1># Hex code for Linux filesystem</span>
$ w <span class=c1># Write changes</span>
$ Y <span class=c1># Confirm</span>
</enter></enter></enter></enter></enter></enter></enter></code></pre></div></table><p>Now, use <code>gdisk -l /dev/nvme0n1</code> to find the number of the swap partition.<h3>Encrypt Filesystem</h3><p>First, <a href=https://wiki.archlinux.org/index.php/Securely_wipe_disk target=_blank rel="noopener noreferrer external">securely wipe the data on the machine</a> to <a href=https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation target=_blank rel="noopener noreferrer external">prepare</a> for the encryption. We do this as follows (where <code>X</code> refers to the partition number of the partition(s) you wish to wipe (at minimum, do the main filesystem partition)).<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ cryptsetup open --type plain -d /dev/urandom /dev/nvme0n1pX to_be_wiped <span class=c1># opens a temporary crypt device</span>
$ lsblk <span class=c1># Check that there is a crypt device under /dev/nvme0n1pX</span>
$ dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/dev/mapper/to_be_wiped <span class=nv>status</span><span class=o>=</span>progress <span class=c1># Wipes the drive with /dev/zero</span>
$ cryptsetup close to_be_wiped <span class=c1># Close the temporary crypt device</span>
</code></pre></div></table><p>Now, we will encrypt the partition. See the <a href=https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption target=_blank rel="noopener noreferrer external">related</a> <a href=https://wiki.archlinux.org/index.php/Dm-crypt/Specialties target=_blank rel="noopener noreferrer external">Arch</a> <a href=https://wiki.archlinux.org/index.php/Dm-crypt/Encrypting_a_non-root_file_system#Partition target=_blank rel="noopener noreferrer external">wiki</a> <a href=https://wiki.archlinux.org/index.php/Dm-crypt/Encrypting_an_entire_system#Simple_partition_layout_with_LUKS target=_blank rel="noopener noreferrer external">pages</a> for details. We use <code>X</code> to refer to the partition number of the Linux root filesystem (third partition created above). Use <a href=https://unix.stackexchange.com/questions/254017/how-to-interpret-cryptsetup-benchmark-results target=_blank rel="noopener noreferrer external">this answer</a> to choose encryption options.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ cryptsetup benchmark <span class=c1># Choose your cipher settings</span>
$ cryptsetup -y -v luksFormat --type luks2 /dev/nvme0n1pX <span class=c1># Set up cryptdevice on the partition</span>
$ cryptsetup open /dev/nvme0n1pX cryptroot <span class=c1># Open the device as cryptroot</span>
$ mkfs -t ext4 -L <span class=s2>"Arch Linux"</span> /dev/mapper/cryptroot <span class=c1># Make the filesystem on the encrypted device</span>
$ mount /dev/mapper/cryptroot /mnt <span class=c1># Mount the filesystem to /mnt (/mnt is on the USB)</span>
</code></pre></div></table><p>Now, check the mapping to make sure it works.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ umount /mnt
$ cryptsetup close cryptroot
$ cryptsetup open /dev/nvme0n1pX cryptroot
$ mount /dev/mapper/cryptroot /mnt
</code></pre></div></table><h3>Turn on Swap Partition</h3><p>We refer to the swap partition created above as <code>Y</code>.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ mkswap -L <span class=s2>"Linux Swap"</span> /dev/nvme0n1pY <span class=c1># Make the swap partition</span>
$ swapon /dev/nvme0n1pY <span class=c1># Turn on the swap partition</span>
$ free -m <span class=c1># Check whether swap is on</span>
</code></pre></div></table><h3>Create Boot Partition</h3><p>We refer to the boot partition created above as <code>Z</code>.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ mkfs -t ext4 /dev/nvme0n1pZ <span class=c1># Create boot partition filesystem</span>
$ mkdir /mnt/boot <span class=c1># Create boot mount point</span>
$ mount /dev/nvme0n1pZ /mnt/boot
$ mkdir /mnt/boot/efi <span class=c1># Create efi boot folder</span>
$ gdisk -l <span class=c1># Find the partition number of the existing EFI partition (from Windows) - U</span>
$ mount /dev/nvme0n1pU /mnt/boot/efi <span class=c1># Mount the EFI partition</span>
</code></pre></div></table><h2>Installing Arch Linux</h2><p>Use <a href=https://git.archlinux.org/arch-install-scripts.git/tree/pacstrap.in target=_blank rel="noopener noreferrer external">pacstrap</a> to install the basic system:<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ pacstrap /mnt base <span class=c1># Just install the basic set of packages</span>
</code></pre></div></table><h3>Configure the System</h3><p>Create an <a href=https://wiki.archlinux.org/index.php/Fstab target=_blank rel="noopener noreferrer external">fstab</a> file for the system, using <a href=https://wiki.archlinux.org/index.php/Persistent_block_device_naming#by-uuid target=_blank rel="noopener noreferrer external">UUID</a> naming:<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ genfstab -pU /mnt >> /mnt/etc/fstab
</code></pre></div></table><p>Make sure that <code>/mnt/etc/fstab</code> lists <code>/boot</code> and <code>/boot/efi</code> as filesystems. If it doesn't, you will have to add them manually, look that up online. Use <code>ls -l /dev/disk/by-uuid/</code>. Optionally, change <code>relatime</code> to <code>noatime</code> on SSD disks to reduce the wear and tear.<h2>Boot into the Arch Install</h2><p>Arch Linux is now completely installed on the system. We are ready to begin setting up the system directly. First, <code>chroot</code> into the newly installed system.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ arch-chroot /mnt
</code></pre></div></table><h3><a href=https://wiki.archlinux.org/index.php/installation_guide#Configure_the_system target=_blank rel="noopener noreferrer external">Basic System Setup</a></h3><p>First we setup the time system. Refer to <a href=https://wiki.archlinux.org/index.php/time target=_blank rel="noopener noreferrer external">Arch Wiki Time</a> for more information.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ ln -s /usr/share/zoneinfo/<region>/<city> /etc/localtime <span class=c1># Set the local timezone</span>
$ hwclock --systohc <span class=c1># Create /etc/adjtime to synchronize the hardware clock</span>
</city></region></code></pre></div></table><p>Now, we set the locale. Uncomment <code>en_US.UTF-8 UTF-8</code> in <code>/etc/locale.gen</code> and run<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ locale-gen
</code></pre></div></table><p>Then, set <code>LANG=en_US.UTF-8</code> in <code>/etc/locale.conf</code> Now, we set the hostname with<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ <span class=nb>echo</span> MYHOSTNAME > /etc/hostname
</code></pre></div></table><p>and update <a href=http://man7.org/linux/man-pages/man5/hosts.5.html target=_blank rel="noopener noreferrer external"><code>/etc/hosts</code></a><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class=codehilite><pre><span></span><code>127.0.0.1       localhost
::1             localhost
127.0.1.1       MYHOSTNAME.localdomain MYHOSTNAME # optional, as far as I can tell
</code></pre></div></table><p>See <a href=https://wiki.archlinux.org/index.php/Network_configuration target=_blank rel="noopener noreferrer external">Arch network configuration</a> for more information.<p>Finally, reset the <code>root</code> password:<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ passwd
</code></pre></div></table><h3><a href=https://wiki.archlinux.org/index.php/GRUB target=_blank rel="noopener noreferrer external">Bootloader (GRUB) Setup</a> and Initial Boot Configuration</h3><p>Install the relevant packages:<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>pacman -Syu grub efibootmgr dosfstools
</code></pre></div></table><p>Now, we will make sure all of the partitions are properly mounted.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ mount -a <span class=c1># Mount all of the partitions listed in fstab</span>
$ lsblk <span class=c1># List block devices, and check that /, /boot, /boot/efi are listed</span>
</code></pre></div></table><p>If they are properly mounted, we will edit <a href=https://wiki.archlinux.org/index.php/mkinitcpio target=_blank rel="noopener noreferrer external"><code>/etc/mkinitcpio.conf</code></a> to include relevant hooks and kernel parameters.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>HOOKS = (... keymap encrypt filesystems keyboard ...)
</code></pre></div></table><p>We will now generate the <a href=https://www.ibm.com/developerworks/library/l-initrd/index.html target=_blank rel="noopener noreferrer external">initrd</a> with<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ mkinitcpio -p linux
</code></pre></div></table><p>Now, we will setup GRUB by setting the following in <code>/etc/default/grub</code> (where <code><device-id></device-id></code> is the <a href=https://wiki.archlinux.org/index.php/persistent_block_device_naming#by-uuid target=_blank rel="noopener noreferrer external">UUID</a> of the encrypted partition from <code>ls -l /dev/disk/by-uuid/</code>):<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class=codehilite><pre><span></span><code>GRUB_CMDLINE_LINUX="cryptdevice=UUID=<device-id>:cryptroot
GRUB_CMDLINE_LINUX_DEFAULT="quiet pci=nomsi"
GRUB_ENABLE_CRYPTODISK=y
</device-id></code></pre></div></table><p>Install GRUB and generate the config file with<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ grub-install --target<span class=o>=</span>x86_64-efi --efi-director<span class=o>=</span>/boot/efi --bootloader-id<span class=o>=</span>grub
$ grub-mkconfig -o /boot/grub/grub.cfg <span class=c1># GRUB configuration</span>
</code></pre></div></table><p>Now, install <code>intel-ucode</code> in order to <a href=https://wiki.archlinux.org/index.php/Microcode#Enabling_Intel_microcode_updates target=_blank rel="noopener noreferrer external">enable Intel microcode</a>.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ pacman -S intel-ucode <span class=c1># Install relevant package</span>
$ grub-mkconfig -o /boot/grub/grub.cfg <span class=c1># regenerate GRUB configuration to use intel-ucode</span>
</code></pre></div></table><p>Also install <code>os-prober</code> so that Windows will be properly set in GRUB on reboot (alternatively, you could create a Windows entry in the GRUB config manually).<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ pacman -S os-prober
</code></pre></div></table><h3>WiFi Setup</h3><p>Before starting up the new machine, we will also install necessary packages to connect to WiFi on restart. We will use <a href=https://wiki.archlinux.org/index.php/netctl target=_blank rel="noopener noreferrer external"><code>netctl</code></a> to manage the WiFi connection. First, we install <a href=https://wiki.archlinux.org/index.php/WPA_supplicant target=_blank rel="noopener noreferrer external">WPA Supplicant</a> to manage secure WiFi connections.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ pacman -S wpa_supplicant
$ cp /etc/netctl/examples/wireless-wpa /etc/netctl/wireless-wpa <span class=c1># copy the interface file</span>
$ vim /etc/netctl/wireless-wpa <span class=c1># fill out the relevant fields</span>
$ wpa_passphrase SSID passphrase <span class=c1># hash passphrase for network</span>
</code></pre></div></table><p>Copy the <code>psk</code> field from the <code>wpa_passphrase</code> command as the <code>Key</code> in the <code>wireless-wpa</code> profile.<h3>Finish up</h3><p>Finally, unmount everything and reboot the system - go back into Arch.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ <span class=nb>exit</span> <span class=c1># exit out of chroot back to the archiso </span>
$ umount -R /mnt <span class=c1># unmount all the devices</span>
$ reboot
</code></pre></div></table><p>You will now boot directly into the Arch install (rather than the <code>archiso</code> on the USB). There is some basic setup remaining. First, run <code>os-prober</code> and update the GRUB config with<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ os-prober <span class=c1># detects the Windows installation and adds it to GRUB config</span>
$ grub-mkconfig -p /boot/grub/grub.cfg
</code></pre></div></table><p>Then, make sure you can connect to WiFi with <code>netctl</code>.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ sudo netctl start wireless-wpa <span class=c1># use the profile created above</span>
$ ping google.com <span class=c1># may take a few moments</span>
</code></pre></div></table><p>Finally, create a new (non-root) user for general use.<table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div><td class=code><div class=codehilite><pre><span></span><code>$ useradd -m -G wheel <username> <span class=c1># Create user</span>
$ passwd <username> <span class=c1># Set password</span>
</username></username></code></pre></div></table><p>You should also set up <a href=https://wiki.archlinux.org/index.php/sudo target=_blank rel="noopener noreferrer external"><code>sudo</code></a> and use <code>visudo</code> to allow the <code>wheel</code> group to use sudo.<p>Restart one more time, and make sure that Windows is listed as an option in the initial GRUB boot window. Choose to boot into it and make sure everything works. Notably, the clock will be off because of the hardware clock settings in Linux - to remedy this, see <a href=https://wiki.archlinux.org/index.php/time#UTC_in_Windows target=_blank rel="noopener noreferrer external">here</a>. You will have to use <code>regedit</code> to add the <code>DWORD</code><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div><td class=code><div class=codehilite><pre><span></span><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TimeZoneInformation\RealTimeIsUniversal
</code></pre></div></table><p>with value <code>1</code> to the registry. In addition, turn off Internet time synchronization in <em>Control Panel > Clock and Region > Date and Time > Internet Time</em>. Reboot to put these changes into effect.<p>Check back for Part 2 to read about basic system configuration, including (but not limited to):<ul><li><span>NVIDIA drivers</span><li><span><a href=https://wiki.archlinux.org/index.php/Dm-crypt/Specialties#Discard.2FTRIM_support_for_solid_state_drives_.28SSD.29 target=_blank rel="noopener noreferrer external">Turn on TRIM</a></span><li><span>Store encrypt key on disk</span><li><span>X setup</span></ul></div></div><div class="column is-12-mobile is-8-desktop is-8-tablet is-flex text"><p class=top-pad-mobile><b>Rahul Yesantharao</b><br><span style=font-size:1rem><i class="fa fa-map-marker"aria-hidden=true></i>   Cambridge, MA</span><p class=is-right><b>Share this post</b><br><span style=font-size:1rem><a target=_blank rel=noopener href="https://twitter.com/intent/tweet?url=https://rahulyesantharao.com/blog/posts/dual-booting-windows-10-and-arch-linux&text=Dual%20Booting%20Windows%2010%20and%20Arch%20Linux"><i class="fa fa-twitter"aria-hidden=true></i> </a>  <a target=_blank rel=noopener href="https://facebook.com/sharer/sharer.php?u=https://rahulyesantharao.com/blog/posts/dual-booting-windows-10-and-arch-linux"><i class="fa fa-facebook"aria-hidden=true></i> </a>  <a target=_blank rel=noopener href="http://www.linkedin.com/shareArticle?mini=true&url=https://rahulyesantharao.com/blog/posts/dual-booting-windows-10-and-arch-linux&title=Dual%20Booting%20Windows%2010%20and%20Arch%20Linux&summary=How%20to%20dual%20boot%20Arch%20Linux%20onto%20a%20Razer%20Blade%2014%22%202017%20%28but%20also%20most%20other%20Windows%2010%20machines%29.&source=rahulyesantharao.com"><i class="fa fa-linkedin"aria-hidden=true></i></a></span></div></div><div class="columns is-centered"><div class="column is-12-mobile is-8-desktop is-8-tablet is-flex text"><p><a target=_self href=/blog/ >← Back To Blog</a></div></div></section><footer><p><a href=https://twitter.com/rahulvgy aria-label=Twitter target=_blank rel="noopener noreferrer external"><i class="fa fa-twitter-square"aria-hidden=true title="View Rahul's Twitter"></i> </a>   <a href=https://github.com/rahulyesantharao/ aria-label=GitHub target=_blank rel="noopener noreferrer external"><i class="fa fa-github"aria-hidden=true title="View Rahul's GitHub"></i> </a>   <a href=https://www.linkedin.com/in/rahulyesantharao aria-label=LinkedIn target=_blank rel="noopener noreferrer external"><i class="fa fa-linkedin-square"aria-hidden=true title="View Rahul's LinkedIn"></i></a><p><i class="fa fa-pencil"aria-hidden=true></i> with <i class="fa fa-code"aria-hidden=true></i> by Rahul Yesantharao</footer><div id=sidenav-overlay onclick=toggleMenu()></div><script src=../../../scripts/main.6304c5800ef16505f2aec5e8c32fa40b.js></script>